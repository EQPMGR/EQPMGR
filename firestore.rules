rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Public read access for bike models and master components
    match /bikeModels/{modelId} {
      allow read: if true;
      allow write: if request.auth != null; // Allow authenticated users (server actions) to write
    }

    match /masterComponents/{componentId} {
      allow read: if true;
      allow write: if request.auth != null; // Allow authenticated users (server actions) to write
    }

    // Users can only read their own document
    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;
      
      // A user can manage all equipment in their own "equipment" subcollection
      match /equipment/{equipmentId} {
        allow read, write, delete: if request.auth.uid == userId;
      }
    }
  }
}
